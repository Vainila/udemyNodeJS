<!DOCTYPE html>
<html lang="en">
   <%- include("../partials/head.ejs")%>
   <body>
      <%- include("../partials/nav.ejs") %>
      <div class="container" id="itemContainer">
         <ul class="collection with-header">
            <% if(items.length > 0 ){ items.forEach(element => { %>
            <li class="collection-item">
               <div>
                  <a href="/items/<%= element.id %>">
                     <%= element.name %> <%= element.price %>
                  </a>

                  <a href="#!" class="secondary-content">
                     <i
                        class="material-icons modal-trigger"
                        href="#modal1"
                        data-id="<%= element.id %>"
                        >edit</i
                     >
                     <i class="material-icons">delete</i>
                  </a>
               </div>
            </li>
            <% }); }else{ } %>
         </ul>
      </div>
      <div id="modal1" class="modal">
         <div class="modal-content">
            <h4>Edit form</h4>

            <form action="" id="edit_form">
               <input type="text" name="name" placeholder="item name" />
               <input type="text" name="price" placeholder="item price" />
               <button class="btn">Update</button>
            </form>
         </div>
      </div>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
      <script>
         var updateId;
         itemContainer.onclick = function (e) {
            console.log("e.target.textContent", e.target.textContent);
            if (e.target.textContent === "edit") {
               updateId = e.target.getAttribute("data-id");
               console.log(updateId);
            }
         };
         edit_form.onsubmit = async function (e) {
            e.preventDefault();
            let data = new FormData(edit_form);
            let responce = await fetch(`/items/${updateId}`, {
               method: "PUT",
               body: new URLSearchParams(data),
               headers: new Headers({
                  "Content-type": "application/x-www-form-urlencoded; charset=UTF-8",
               }),
            });
            let result = await responce.json();
            edit_form.reset();
            window.location.reload();
         };
         document.addEventListener("DOMContentLoaded", function () {
            var elems = document.querySelectorAll(".modal");
            var instances = M.Modal.init(elems);
         });
      </script>
   </body>
</html>
